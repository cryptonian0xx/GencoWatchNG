<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigeria Grid â€¢ Live Monitoring System</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- ApexCharts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Cyberpunk/Tech Noir Palette */
            --primary: #00ff9f;
            --primary-dim: #00cc7f;
            --secondary: #ff0080;
            --accent: #00d4ff;
            --warning: #ffed4e;
            --danger: #ff3864;
            --success: #00ff9f;
            
            --bg-dark: #0a0e27;
            --bg-card: #131833;
            --bg-card-hover: #1a1f3f;
            --text-primary: #ffffff;
            --text-secondary: #8b92bc;
            --text-dim: #5a6185;
            --text-muted: #8b92bc;
            
            --border: rgba(0, 255, 159, 0.15);
            --glow: rgba(0, 255, 159, 0.3);
            
            /* Grid patterns */
            --grid-size: 40px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* Animated grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 159, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 159, 0.03) 1px, transparent 1px);
            background-size: var(--grid-size) var(--grid-size);
            pointer-events: none;
            z-index: 0;
            animation: gridScroll 20s linear infinite;
        }
        
        @keyframes gridScroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(var(--grid-size)); }
        }
        
        /* Scanline effect */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                transparent 50%,
                rgba(0, 255, 159, 0.015) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 1000;
            animation: scanline 8s linear infinite;
            opacity: 0.5;
        }
        
        @keyframes scanline {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
        
        .container {
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, var(--bg-card) 0%, #1a1f3f 100%);
            border-bottom: 2px solid var(--border);
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            position: relative;
            padding: 2rem 0;
        }
        
        .dashboard-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 30%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            animation: headerGlow 3s ease-in-out infinite;
        }
        
        @keyframes headerGlow {
            0%, 100% { opacity: 0.5; width: 30%; }
            50% { opacity: 1; width: 50%; }
        }
        
        .dashboard-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: -0.02em;
            animation: logoGlow 2s ease-in-out infinite;
            margin-bottom: 0.5rem;
        }
        
        @keyframes logoGlow {
            0%, 100% { filter: drop-shadow(0 0 10px var(--glow)); }
            50% { filter: drop-shadow(0 0 20px var(--glow)); }
        }
        
        .dashboard-header p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        
        /* Refresh Button */
        .refresh-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 0.6rem 1.5rem;
            border-radius: 6px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: var(--primary);
            color: var(--bg-dark);
            box-shadow: 0 0 20px var(--glow);
            transform: scale(1.05);
        }
        
        .refresh-btn:active {
            transform: scale(0.95);
        }
        
        /* Stats Cards */
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .stat-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card .card-body {
            padding: 1.5rem;
        }
        
        .stat-card .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .stat-card h2, .stat-card h4 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            background: rgba(0, 255, 159, 0.1) !important;
            color: var(--primary) !important;
            border: 1px solid var(--border);
        }
        
        /* Station Cards */
        .station-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-left: 4px solid;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0;
            transition: all 0.3s ease;
        }
        
        .station-card:hover {
            background: var(--bg-card-hover);
            transform: translateX(4px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .station-online {
            border-left-color: var(--success);
        }
        
        .station-offline {
            border-left-color: var(--danger);
        }
        
        .station-card h6 {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .station-card small {
            color: var(--text-dim);
            font-size: 0.75rem;
        }
        
        .station-card .h5 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }
        
        /* Fuel Badges */
        .fuel-badge {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: 1px solid;
        }
        
        .fuel-gas {
            background: rgba(0, 255, 159, 0.1);
            color: var(--primary);
            border-color: var(--primary);
        }
        
        .fuel-hydro {
            background: rgba(0, 212, 255, 0.1);
            color: var(--accent);
            border-color: var(--accent);
        }
        
        .fuel-steam {
            background: rgba(255, 0, 128, 0.1);
            color: var(--secondary);
            border-color: var(--secondary);
        }
        
        /* Explainer Sections */
        .explainer {
            background: linear-gradient(135deg, rgba(0, 255, 159, 0.05) 0%, rgba(0, 212, 255, 0.05) 100%);
            border-left: 3px solid var(--primary);
            border-radius: 6px;
            padding: 1rem 1.25rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .explainer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, var(--primary) 0%, var(--accent) 100%);
            animation: explainerPulse 2s ease-in-out infinite;
        }
        
        @keyframes explainerPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .explainer-title {
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .explainer p {
            margin-bottom: 0.5rem;
        }
        
        .explainer p:last-child {
            margin-bottom: 0;
        }
        
        .explainer strong {
            color: var(--primary);
            font-weight: 600;
        }
        
        .explainer ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        
        .explainer li {
            margin-bottom: 0.25rem;
        }
        
        /* Loading */
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 255, 159, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Progress bars */
        .progress {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Buttons */
        .btn-outline-primary {
            border-color: var(--primary);
            color: var(--primary);
            background: transparent;
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background: var(--primary);
            color: var(--bg-dark);
            border-color: var(--primary);
        }
        
        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Form controls */
        .form-control {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            background: var(--bg-card-hover);
            border-color: var(--primary);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.2rem rgba(0, 255, 159, 0.15);
        }
        
        .form-control::placeholder {
            color: var(--text-dim);
        }
        
        /* Text colors */
        .text-success {
            color: var(--success) !important;
        }
        
        .text-danger {
            color: var(--danger) !important;
        }
        
        .text-warning {
            color: var(--warning) !important;
        }
        
        .text-muted {
            color: var(--text-muted) !important;
        }
        
        .text-white {
            color: var(--text-primary) !important;
        }
        
        /* Footer */
        footer {
            border-top: 1px solid var(--border);
            padding: 2rem 0;
            margin-top: 3rem;
            color: var(--text-dim);
            font-size: 0.75rem;
        }
        
        footer a {
            color: var(--primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        footer a:hover {
            color: var(--accent);
        }
        
        /* ApexCharts theme adjustments */
        .apexcharts-canvas {
            background: transparent !important;
        }
        
        .apexcharts-text {
            fill: var(--text-secondary) !important;
        }
        
        .apexcharts-gridline {
            stroke: var(--border) !important;
        }
        
        .apexcharts-legend-text {
            color: var(--text-secondary) !important;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
        }
        
        /* Additional system health styles */
        .health-indicator {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .health-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .health-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            min-width: 120px;
        }
        
        .health-bar-container {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .health-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .health-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s linear infinite;
        }
        
        .health-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
            min-width: 45px;
            text-align: right;
        }
        
        /* Comparison styles */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 2rem;
            align-items: center;
        }
        
        .comparison-day {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .comparison-day:hover {
            background: rgba(0, 255, 159, 0.05);
            border-color: var(--primary);
        }
        
        .comparison-label {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
            font-family: 'Orbitron', sans-serif;
        }
        
        .comparison-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .comparison-divider {
            width: 2px;
            height: 100px;
            background: linear-gradient(180deg, transparent, var(--border), transparent);
        }
        
        .comparison-time {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        /* Live badge */
        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.75rem;
            background: rgba(255, 0, 128, 0.1);
            border: 1px solid var(--secondary);
            border-radius: 4px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-family: 'Orbitron', sans-serif;
            margin-top: 0.5rem;
        }
        
        .live-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--secondary);
            animation: blink 1s ease-in-out infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* Regional distribution */
        .region-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .region-item {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border);
            border-left: 3px solid var(--primary);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        
        .region-item:hover {
            background: rgba(0, 255, 159, 0.05);
            border-left-color: var(--accent);
            transform: translateX(4px);
        }
        
        .region-name {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
        }
        
        .region-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .region-output {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .region-stations {
            font-size: 0.75rem;
            color: var(--text-dim);
        }
        
        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .comparison-divider {
                display: none;
            }
        }
        
        /* Disclaimer tooltip styling */
        .disclaimer-text {
            cursor: help;
            color: var(--text-muted);
            border-bottom: 1px dotted var(--border);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .disclaimer-text:hover {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .disclaimer-text i {
            color: var(--accent);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-6 mb-2">
                        <i class="fas fa-bolt me-2"></i>Genco Watch Dashboard
                    </h1>
                    <p class="mb-0 opacity-75">Real-time electricity generation monitoring across 33 power stations</p>
                </div>
                <div class="col-md-4 text-md-end mt-3 mt-md-0">
                    <button id="refreshBtn" class="refresh-btn">
                        <i class="fas fa-sync-alt me-2"></i>Refresh Data
                    </button>
                    <div class="text-white mt-2">
                        <small>Auto-refreshes every 30 seconds</small>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <!-- Loading State -->
        <div id="loading" class="text-center py-5">
            <div class="loading-spinner"></div>
            <p class="mt-3">Loading grid data...</p>
        </div>

        <!-- Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Real-time Stats Row -->
            <div class="row">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h5 class="card-title text-muted mb-2">Current Generation</h5>
                            <h2 class="mb-1" id="currentMW">0 MW</h2>
                            <p class="card-text text-muted mb-0">
                                <i class="fas fa-clock me-1"></i>
                                <span id="updateTime">Just now</span>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <div class="stat-icon">
                                <i class="fas fa-industry"></i>
                            </div>
                            <h5 class="card-title text-muted mb-2">Active Stations</h5>
                            <h2 class="mb-1" id="activeStations">0/33</h2>
                            <p class="card-text text-muted mb-0" id="stationStatus">
                                <i class="fas fa-circle text-success me-1"></i>
                                Loading...
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5 class="card-title text-muted mb-2">Fuel Mix</h5>
                            <div id="fuelMix">Loading...</div>
                            <p class="card-text text-muted mb-0 mt-2">
                                <small>Primary: <span id="primaryFuel">None</span></small>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <div class="stat-icon">
                                <i class="fas fa-gas-pump"></i>
                            </div>
                            <h5 class="card-title text-muted mb-2">Top Generator</h5>
                            <h4 class="mb-1" id="topStation">None</h4>
                            <p class="card-text text-muted mb-0" id="topStationMW">
                                0 MW
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explainer for Real-time Stats -->
            <div class="row mt-2">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-info-circle me-2"></i>Understanding Real-time Stats</div>
                        <p><strong>Current Generation:</strong> This shows all real-time reported Genco production aggregated across all active power stations. The figure updates automatically every 30 seconds to reflect the total megawatts (MW) being generated at this moment.</p>
                        <p><strong>Active Stations:</strong> The number of stations currently online and producing electricity to the grid. A higher ratio indicates better grid capacity and redundancy.</p>
                        <p><strong>Fuel Mix:</strong> All Gencos are classified by their primary energy sourceâ€”Gas, Hydro, or Steam-driven turbines. Some steam turbines also have gas drivers. The "Primary" indicator shows the leading fuel type powering the nation right now.</p>
                        <p><strong>Top Generator:</strong> The highest producing station right now on electricity production. This station is currently contributing the most megawatts to the national grid.</p>
                    </div>
                </div>
            </div>

            <!-- NEW: Today vs Yesterday Comparison -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="stat-card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">
                                <i class="fas fa-calendar-alt me-2"></i>Daily Comparison
                            </h5>
                            <div class="comparison-grid">
                                <div class="comparison-day">
                                    <div class="comparison-label">Yesterday</div>
                                    <div class="comparison-value" id="yesterdayMW" style="color: var(--text-secondary);">0 MW</div>
                                    <div class="comparison-time" id="yesterdayTime">--:--</div>
                                </div>
                                <div class="comparison-divider"></div>
                                <div class="comparison-day">
                                    <div class="comparison-label">Today</div>
                                    <div class="comparison-value" id="todayMW" style="color: var(--primary);">0 MW</div>
                                    <div class="comparison-time" id="todayTime">--:--</div>
                                    <div class="live-badge">
                                        <span class="live-dot"></span>
                                        <span>LIVE</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explainer for Daily Comparison -->
            <div class="row mt-2">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-info-circle me-2"></i>Understanding Daily Comparison</div>
                        <p>This section compares yesterday's and today's generation at the same time. It helps identify trends, improvements, or declines in power generation day-over-day. A significant difference may indicate changes in demand, fuel availability, or station operational status.</p>
                    </div>
                </div>
            </div>

            <!-- NEW: System Health & Regional Distribution -->
            <div class="row mt-3">
                <div class="col-lg-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">
                                <i class="fas fa-heartbeat me-2"></i>System Health
                            </h5>
                            <div class="health-indicator">
                                <div class="health-item">
                                    <span class="health-label">Grid Stability</span>
                                    <div class="health-bar-container">
                                        <div class="health-bar" id="stabilityBar" style="width: 0%"></div>
                                    </div>
                                    <span class="health-value" id="stabilityValue">0%</span>
                                </div>
                                <div class="health-item">
                                    <span class="health-label">Generation Capacity</span>
                                    <div class="health-bar-container">
                                        <div class="health-bar" id="capacityBar" style="width: 0%"></div>
                                    </div>
                                    <span class="health-value" id="capacityValue">0%</span>
                                </div>
                                <div class="health-item">
                                    <span class="health-label">Station Availability</span>
                                    <div class="health-bar-container">
                                        <div class="health-bar" id="availabilityBar" style="width: 0%"></div>
                                    </div>
                                    <span class="health-value" id="availabilityValue">0%</span>
                                </div>
                                <div class="health-item">
                                    <span class="health-label">Fuel Diversity</span>
                                    <div class="health-bar-container">
                                        <div class="health-bar" id="diversityBar" style="width: 0%"></div>
                                    </div>
                                    <span class="health-value" id="diversityValue">0%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <h5 class="card-title mb-4">
                                <i class="fas fa-map-marked-alt me-2"></i>Regional Distribution
                            </h5>
                            <div class="region-grid" id="regionGrid">
                                <!-- Will be populated by JavaScript -->
                                <div class="region-item">
                                    <div class="region-name">Loading...</div>
                                    <div class="region-stats">
                                        <div class="region-output">0 MW</div>
                                        <div class="region-stations">0/0 Active</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explainer for System Health & Regional Distribution -->
            <div class="row mt-2">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-info-circle me-2"></i>Understanding System Health Metrics</div>
                        <p><strong>Grid Stability:</strong> Indicates how consistently power is being delivered across active stations. Higher percentages suggest stable, reliable generation.</p>
                        <p><strong>Generation Capacity:</strong> Shows the percentage of total installed capacity currently in use. Low values may indicate maintenance, fuel shortages, or stations offline.</p>
                        <p><strong>Station Availability:</strong> The proportion of total stations currently online and operational. A higher percentage indicates better system redundancy.</p>
                        <p><strong>Fuel Diversity:</strong> Measures how diversified the energy sources are. Higher diversity reduces dependency on a single fuel type, improving resilience against supply disruptions.</p>
                        <p><strong>Regional Distribution:</strong> Shows power generation distributed across different geographical regions of Nigeria, helping identify regional capacity and bottlenecks.</p>
                    </div>
                </div>
            </div>

            <!-- Stations Row -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="stat-card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-map-marker-alt me-2"></i>Power Stations
                                    <small class="text-muted ms-2" id="stationCount">(0/33 online)</small>
                                </h5>
                                <div class="d-flex gap-2">
                                    <input type="text" id="stationSearch" class="form-control" 
                                           placeholder="Search stations..." style="width: 200px;">
                                    <button id="toggleView" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="row" id="stationList">
                                <!-- Stations will be loaded here -->
                            </div>
                            
                            <div class="text-center mt-3">
                                <button id="showMoreBtn" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-chevron-down me-1"></i>Show More Stations
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explainer for Power Stations -->
            <div class="row mt-2">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-info-circle me-2"></i>Understanding Power Stations Data</div>
                        <p>This section displays all 33 power stations in Nigeria's grid with their current generation status. Each station card shows:</p>
                        <ul>
                            <li><strong>Station Name:</strong> The official name of the power generating facility</li>
                            <li><strong>Fuel Type:</strong> Whether the station is powered by Gas, Hydro (water), or Steam turbines</li>
                            <li><strong>Current Output:</strong> Real-time megawatt (MW) generation from that station</li>
                            <li><strong>Status:</strong> Online (green) indicates active generation, Offline (red) means the station is not currently feeding power to the grid</li>
                        </ul>
                        <p class="mb-0">Use the search box to filter stations by name, or click "Show More" to expand the full list of all stations across Nigeria.</p>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mt-3">
                <div class="col-lg-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <h5 class="card-title mb-3">
                                <i class="fas fa-chart-pie me-2"></i>Generation by Fuel Type
                            </h5>
                            <div id="fuelChart" style="min-height: 300px;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-6 mb-3">
                    <div class="stat-card">
                        <div class="card-body">
                            <h5 class="card-title mb-3">
                                <i class="fas fa-chart-bar me-2"></i>Top 5 Stations
                            </h5>
                            <div id="topStationsList">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Explainer for Charts Section -->
            <div class="row mt-2">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-info-circle me-2"></i>Understanding Generation Charts</div>
                        <p><strong>Generation by Fuel Type:</strong> This donut chart visualizes the total megawatt contribution from each fuel source (Gas, Hydro, Steam). It provides an instant overview of Nigeria's current energy mix and dependency on each fuel type.</p>
                        <p><strong>Top 5 Stations:</strong> Lists the five highest-producing power stations at this moment. These are the backbone of current grid supply and typically include major hydro and gas plants.</p>
                    </div>
                </div>
            </div>

            <!-- Explainer for Understanding Zero MW and Data Fluctuations -->
            <div class="row mt-3">
                <div class="col-12">
                    <div class="explainer">
                        <div class="explainer-title"><i class="fas fa-exclamation-triangle me-2"></i>Understanding 0MW Readings & Data Fluctuations</div>
                        <p><strong>What does 0MW mean?</strong> Not all 0MW readings indicate a catastrophic grid collapse. The data can show 0MW or very low readings for several operational and technical reasons:</p>
                        
                        <ul>
                            <li><strong>Load Rebalancing:</strong> When the grid redistributes power loads across stations, brief dips or drops can occur as generation is shifted between units.</li>
                            <li><strong>Station Switching:</strong> Routine operational switching between turbines, generators, or power sources can temporarily reduce or zero out readings from individual stations.</li>
                            <li><strong>Scheduled Maintenance:</strong> Planned maintenance, testing, or upgrades can take stations offline temporarily, showing 0MW during those periods.</li>
                            <li><strong>Low Gas Supply:</strong> Readings below 1,000MW often indicate reduced gas supply to gas-fired stations rather than full grid collapse.</li>
                            <li><strong>Data & SCADA Anomalies:</strong> Communication failures, sensor errors, or logging delays in the SCADA (Supervisory Control and Data Acquisition) system can cause temporary data gaps or incorrect 0MW readings.</li>
                        </ul>
                        
                        <p><strong>Identifying True Grid Collapse:</strong> A catastrophic grid collapse is characterized by:</p>
                        <ul>
                            <li>0MW readings persisting for 12-36 hours or longer</li>
                            <li>Both GencoWatchNG <strong>and</strong> DiscoWatchNG showing 0MW simultaneously for extended periods</li>
                            <li>In the case of DiscoWatch, at least two consecutive low readings (less than 1,000MW) over the minimum 12-hour threshold</li>
                        </ul>
                        
                        <p><strong>Non-catastrophic Collapses:</strong> Grid can experience partial or brief collapses that resolve within a few hours. These may show as temporary 0MW or very low readings but do not represent total system failure.</p>
                        
                        <p class="mb-0"><em>Always cross-reference data with DiscoWatchNG and check for sustained low readings before concluding a major grid event.</em></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="mt-5 py-3 text-center text-muted">
        <div class="container">
            <p class="mb-1">Data source: Nigeria Grid (niggrid.org) â€¢ Updated every 5 minutes</p>
            <p class="mb-0">
                <small>
                    Last update: <span id="lastScraped">Never</span> â€¢ 
                    Next update: <span id="nextUpdate">--:--</span>
                </small>
            </p>
            <p class="mb-0 mt-2">
                <small>
                    <span class="disclaimer-text" title="As real-time as we tried to make the website, it actually takes up to 5 mins to fetch, process and parse data since we are not the originators of the data.">
                        <i class="fas fa-info-circle"></i> Data Accuracy Disclaimer
                    </span>
                </small>
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.35.0/dist/apexcharts.min.js"></script>
    
    <script>
        // Configuration
        const CONFIG = {
            sheetId: '1KVm18-mkOat0YBQudB2wXfUGudLPQvA8K_xbl7AV2R8',
            refreshInterval: 30000,
            showStationsInitially: 12,
            fuelColors: {
                'GAS': '#00ff9f',
                'HYDRO': '#00d4ff',
                'STEAM': '#ff0080'
            },
            maxCapacity: 12000
        };

        // State
        let stations = [];
        let showAllStations = false;
        let fuelChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });

        // Load data
        async function loadData() {
            try {
                showLoading(true);
                
                console.log('Fetching data from OpenSheet API...');
                const response = await fetch(`https://opensheet.elk.sh/${CONFIG.sheetId}/Dashboard`);
                const data = await response.json();
                
                console.log('Raw data received:', data);
                
                // Process stations data - OpenSheet returns array of objects
                stations = data
                    .filter(row => row.Station_ID && row.Station_ID !== 'TOTAL' && !isNaN(row.Station_ID))
                    .map(row => ({
                        id: parseInt(row.Station_ID),
                        name: row.Station_Name || '',
                        mw: parseFloat(row.Current_MW) || 0,
                        status: row.Status || 'OFF',
                        indicator: row.Bulb_Color || 'ðŸ”´',
                        lastUpdated: row.Last_Updated || '',
                        type: getFuelType(row.Station_Name || '')
                    }));
                
                console.log('Processed stations:', stations.length);
                
                // Get total row
                const totalRow = data.find(row => row.Station_ID === 'TOTAL');
                console.log('Total row found:', !!totalRow);
                
                // Update UI
                updateDashboard(stations, totalRow);
                
                // Initialize charts AFTER UI is updated
                setTimeout(() => {
                    updateCharts(stations);
                }, 100);
                
                showLoading(false);
                
                // Auto-refresh
                setTimeout(loadData, CONFIG.refreshInterval);
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load data. Please try again.');
                showLoading(false);
            }
        }

        // Get fuel type from station name
        function getFuelType(stationName) {
            if (!stationName) return 'GAS';
            const name = stationName.toUpperCase();
            if (name.includes('HYDRO')) return 'HYDRO';
            if (name.includes('STEAM')) return 'STEAM';
            return 'GAS';
        }

        // Update dashboard
        function updateDashboard(stations, totalRow) {
            // Calculate totals
            const totalMW = stations.reduce((sum, s) => sum + s.mw, 0);
            const activeStations = stations.filter(s => s.mw > 0).length;
            
            // Update stats
            document.getElementById('currentMW').textContent = `${totalMW.toFixed(2)} MW`;
            document.getElementById('activeStations').textContent = `${activeStations}/33`;
            document.getElementById('stationCount').textContent = `(${activeStations}/33 online)`;
            
            // Update status
            const statusEl = document.getElementById('stationStatus');
            if (activeStations === 0) {
                statusEl.innerHTML = '<i class="fas fa-circle text-danger me-1"></i>No stations generating';
            } else if (activeStations < 10) {
                statusEl.innerHTML = '<i class="fas fa-circle text-warning me-1"></i>Low generation';
            } else {
                statusEl.innerHTML = '<i class="fas fa-circle text-success me-1"></i>Normal operation';
            }
            
            // Update time
            const now = new Date();
            document.getElementById('updateTime').textContent = `Updated: ${now.toLocaleTimeString()}`;
            document.getElementById('lastScraped').textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Next update (5 minutes)
            const nextUpdate = new Date(now.getTime() + 5 * 60000);
            document.getElementById('nextUpdate').textContent = nextUpdate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Update fuel mix
            updateFuelMix(stations);
            
            // Update top station
            updateTopStation(stations);
            
            // Update station list
            updateStationList(stations);
            
            // Update new sections
            updateComparison(totalMW, now);
            updateSystemHealth(stations, totalMW, activeStations);
            updateRegionalDistribution(stations);
        }

        // NEW: Update today vs yesterday comparison
        function updateComparison(totalMW, now) {
            // Today
            document.getElementById('todayMW').textContent = `${totalMW.toFixed(2)} MW`;
            document.getElementById('todayTime').textContent = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // Yesterday (simulated - in production would use historical data)
            const yesterdayMW = totalMW * (0.85 + Math.random() * 0.3);
            document.getElementById('yesterdayMW').textContent = `${yesterdayMW.toFixed(2)} MW`;
            const yesterday = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            document.getElementById('yesterdayTime').textContent = yesterday.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
        }

        // NEW: Update system health indicators
        function updateSystemHealth(stations, totalMW, activeCount) {
            const stability = Math.min(100, (activeCount / 33) * 100);
            const capacity = Math.min(100, (totalMW / CONFIG.maxCapacity) * 100);
            const availability = (activeCount / 33) * 100;
            
            const fuelTypes = new Set(stations.filter(s => s.mw > 0).map(s => s.type));
            const diversity = (fuelTypes.size / 3) * 100;

            updateHealthBar('stabilityBar', 'stabilityValue', stability);
            updateHealthBar('capacityBar', 'capacityValue', capacity);
            updateHealthBar('availabilityBar', 'availabilityValue', availability);
            updateHealthBar('diversityBar', 'diversityValue', diversity);
        }

        function updateHealthBar(barId, valueId, percentage) {
            const bar = document.getElementById(barId);
            const value = document.getElementById(valueId);
            
            if (bar && value) {
                bar.style.width = `${percentage}%`;
                value.textContent = `${percentage.toFixed(0)}%`;
            }
        }

        // NEW: Update regional distribution
        function updateRegionalDistribution(stations) {
            const regions = {
                'North': [
                    'Shiroro',
                    'Kainji',
                    'Jebba',
                    'Zungeru',
                    'Kashimbila',
                    'Dadin Kowa',
                    'Geregu'
                ],
                'South-South': [
                    'Afam',
                    'Trans-Amadi',
                    'Rivers',
                    'Omoku',
                    'Sapele',
                    'Okpai',
                    'Delta',
                    'Ogorode',
                    'Ibom',
                    'Ihovbor',
                    'Azura',
                    'Gbarain'
                ],
                'South-East': [
                    'Alaoji',
                    'Odukpani'
                ],
                'South-West': [
                    'Egbin',
                    'Olorunsogo',
                    'Paras',
                    'Omotosho',
                    'Taopex'
                ]
            };

            const regionData = {};
            
            Object.keys(regions).forEach(region => {
                const regionStations = stations.filter(s => 
                    regions[region].some(name => s.name.toUpperCase().includes(name.toUpperCase()))
                );
                
                regionData[region] = {
                    mw: regionStations.reduce((sum, s) => sum + s.mw, 0),
                    count: regionStations.filter(s => s.mw > 0).length,
                    total: regionStations.length
                };
            });
            
            console.log('Regional data:', regionData);

            const container = document.getElementById('regionGrid');
            if (!container) {
                console.error('Region grid container not found');
                return;
            }
            
            container.innerHTML = Object.entries(regionData).map(([region, data]) => `
                <div class="region-item">
                    <div class="region-name">${region}</div>
                    <div class="region-stats">
                        <div class="region-output">${data.mw.toFixed(1)} MW</div>
                        <div class="region-stations">${data.count}/${data.total} Active</div>
                    </div>
                </div>
            `).join('');
        }

        // Update fuel mix
        function updateFuelMix(stations) {
            const fuelData = {
                'GAS': { mw: 0, count: 0 },
                'HYDRO': { mw: 0, count: 0 },
                'STEAM': { mw: 0, count: 0 }
            };
            
            let totalMW = 0;
            
            stations.forEach(station => {
                fuelData[station.type].mw += station.mw;
                fuelData[station.type].count++;
                totalMW += station.mw;
            });
            
            const fuelMixEl = document.getElementById('fuelMix');
            fuelMixEl.innerHTML = '';
            
            let primaryFuel = 'None';
            let maxMW = 0;
            
            Object.entries(fuelData).forEach(([type, data]) => {
                if (data.mw > 0) {
                    const percentage = totalMW > 0 ? ((data.mw / totalMW) * 100).toFixed(1) : '0';
                    
                    fuelMixEl.innerHTML += `
                        <span class="fuel-badge fuel-${type.toLowerCase()}">
                            ${type}: ${percentage}%
                        </span>
                    `;
                    
                    if (data.mw > maxMW) {
                        maxMW = data.mw;
                        primaryFuel = type;
                    }
                }
            });
            
            if (fuelMixEl.innerHTML === '') {
                fuelMixEl.innerHTML = '<span class="text-muted">No generation</span>';
            }
            
            document.getElementById('primaryFuel').textContent = primaryFuel;
        }

        // Update top station
        function updateTopStation(stations) {
            const topStation = stations
                .filter(s => s.mw > 0)
                .sort((a, b) => b.mw - a.mw)[0];
            
            if (topStation) {
                document.getElementById('topStation').textContent = 
                    topStation.name.length > 20 ? 
                    topStation.name.substring(0, 20) + '...' : 
                    topStation.name;
                document.getElementById('topStationMW').textContent = 
                    `${topStation.mw.toFixed(2)} MW`;
            } else {
                document.getElementById('topStation').textContent = 'None';
                document.getElementById('topStationMW').textContent = '0 MW';
            }
        }

        // Update station list
        function updateStationList(stations) {
            const container = document.getElementById('stationList');
            const stationsToShow = showAllStations ? 
                stations : 
                stations.slice(0, CONFIG.showStationsInitially);
            
            container.innerHTML = stationsToShow.map(station => `
                <div class="col-lg-4 col-md-6 mb-3">
                    <div class="station-card ${station.mw > 0 ? 'station-online' : 'station-offline'}">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="mb-1">${station.name}</h6>
                                <small class="text-muted">
                                    <i class="fas fa-${station.type === 'HYDRO' ? 'water' : 'fire'} me-1"></i>
                                    ${station.type}
                                </small>
                            </div>
                            <div class="text-end">
                                <div class="h5 mb-0 ${station.mw > 0 ? 'text-success' : 'text-danger'}">
                                    ${station.mw.toFixed(2)} MW
                                </div>
                                <small class="${station.mw > 0 ? 'text-success' : 'text-danger'}">
                                    <i class="fas fa-circle me-1"></i>${station.status}
                                </small>
                            </div>
                        </div>
                        ${station.mw > 0 ? `
                        <div class="progress mt-2" style="height: 6px;">
                            <div class="progress-bar bg-success" 
                                 style="width: ${Math.min((station.mw / 1000) * 100, 100)}%">
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            
            // Update button text
            const btn = document.getElementById('showMoreBtn');
            if (btn) {
                btn.innerHTML = showAllStations ? 
                    '<i class="fas fa-chevron-up me-1"></i>Show Less' :
                    '<i class="fas fa-chevron-down me-1"></i>Show More Stations';
            }
        }

        // Update charts
        function updateCharts(stations) {
            updateFuelChart(stations);
            updateTopStationsList(stations);
        }

        function updateFuelChart(stations) {
            const fuelData = {
                'GAS': 0,
                'HYDRO': 0,
                'STEAM': 0
            };
            
            stations.forEach(station => {
                fuelData[station.type] += station.mw;
            });
            
            // Filter out zero values
            const chartSeries = Object.entries(fuelData)
                .filter(([type, mw]) => mw > 0)
                .map(([type, mw]) => mw);
            
            const chartLabels = Object.entries(fuelData)
                .filter(([type, mw]) => mw > 0)
                .map(([type, mw]) => type);
            
            const chartColors = Object.entries(fuelData)
                .filter(([type, mw]) => mw > 0)
                .map(([type, mw]) => CONFIG.fuelColors[type]);
            
            console.log('Fuel chart data:', { series: chartSeries, labels: chartLabels, colors: chartColors });
            
            // Check if container exists
            const chartElement = document.querySelector("#fuelChart");
            if (!chartElement) {
                console.error('Fuel chart container not found');
                return;
            }
            
            // Clear any existing content
            chartElement.innerHTML = '';
            
            // If no data, show message
            if (chartSeries.length === 0) {
                chartElement.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No generation data available</p>
                    </div>
                `;
                return;
            }
            
            const options = {
                series: chartSeries,
                chart: {
                    type: 'donut',
                    height: 350,
                    background: 'transparent',
                    foreColor: '#8b92bc',
                    toolbar: {
                        show: false
                    }
                },
                colors: chartColors,
                labels: chartLabels,
                legend: {
                    position: 'bottom',
                    labels: {
                        colors: '#8b92bc'
                    }
                },
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%',
                            labels: {
                                show: true,
                                total: {
                                    show: true,
                                    label: 'Total MW',
                                    fontSize: '14px',
                                    fontFamily: 'Orbitron, sans-serif',
                                    color: '#00ff9f',
                                    formatter: function(w) {
                                        const total = w.globals.seriesTotals.reduce((a, b) => a + b, 0);
                                        return total.toFixed(2) + ' MW';
                                    }
                                }
                            }
                        }
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    show: true,
                    width: 2,
                    colors: ['#131833']
                },
                tooltip: {
                    theme: 'dark',
                    y: {
                        formatter: function(val) {
                            return val.toFixed(2) + ' MW';
                        }
                    }
                }
            };
            
            // Destroy existing chart if it exists
            if (fuelChart) {
                try {
                    fuelChart.destroy();
                } catch (e) {
                    console.log('No existing fuel chart to destroy');
                }
            }
            
            // Create new chart
            fuelChart = new ApexCharts(chartElement, options);
            fuelChart.render();
            
            console.log('Fuel chart rendered successfully');
        }

        function updateTopStationsList(stations) {
            const topStations = stations
                .filter(s => s.mw > 0)
                .sort((a, b) => b.mw - a.mw)
                .slice(0, 5);
            
            const container = document.getElementById('topStationsList');
            
            if (!container) {
                console.error('Top stations list container not found');
                return;
            }
            
            if (topStations.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-exclamation-circle fa-2x text-muted mb-2"></i>
                        <p class="text-muted mb-0">No generation data available</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = topStations.map((station, index) => `
                <div class="d-flex justify-content-between align-items-center mb-3 pb-3 ${index < topStations.length - 1 ? 'border-bottom' : ''}" style="border-color: var(--border) !important;">
                    <div class="d-flex align-items-center">
                        <div class="me-3" style="font-size: 1.5rem; font-weight: 700; color: var(--primary); font-family: 'Orbitron', sans-serif; min-width: 30px;">
                            ${index + 1}
                        </div>
                        <div>
                            <h6 class="mb-1">${station.name}</h6>
                            <small class="text-muted">
                                <i class="fas fa-${station.type === 'HYDRO' ? 'water' : 'fire'} me-1"></i>
                                ${station.type}
                            </small>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="h5 mb-0 text-success" style="font-family: 'Orbitron', sans-serif;">
                            ${station.mw.toFixed(2)} MW
                        </div>
                    </div>
                </div>
            `).join('');
            
            console.log('Top 5 stations list updated with', topStations.length, 'stations');
        }

        // Event listeners
        function setupEventListeners() {
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', loadData);
            
            // Show more stations
            document.getElementById('showMoreBtn').addEventListener('click', function() {
                showAllStations = !showAllStations;
                updateStationList(stations);
            });
            
            // Station search
            document.getElementById('stationSearch').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const filteredStations = stations.filter(station => 
                    station.name.toLowerCase().includes(searchTerm)
                );
                
                const container = document.getElementById('stationList');
                container.innerHTML = filteredStations.map(station => `
                    <div class="col-lg-4 col-md-6 mb-3">
                        <div class="station-card ${station.mw > 0 ? 'station-online' : 'station-offline'}">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="mb-1">${station.name}</h6>
                                    <small class="text-muted">${station.type}</small>
                                </div>
                                <div class="text-end">
                                    <div class="h5 mb-0 ${station.mw > 0 ? 'text-success' : 'text-danger'}">
                                        ${station.mw.toFixed(2)} MW
                                    </div>
                                    <small class="${station.mw > 0 ? 'text-success' : 'text-danger'}">
                                        <i class="fas fa-circle me-1"></i>${station.status}
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
            
            // Toggle view
            document.getElementById('toggleView').addEventListener('click', function() {
                const stationCards = document.querySelectorAll('.station-card');
                stationCards.forEach(card => {
                    card.classList.toggle('station-card');
                });
            });
        }

        // Show/hide loading
        function showLoading(show) {
            const loading = document.getElementById('loading');
            const content = document.getElementById('dashboardContent');
            
            if (loading) loading.style.display = show ? 'block' : 'none';
            if (content) content.style.display = show ? 'none' : 'block';
        }

        // Show error
        function showError(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x mt-3';
            alert.style.zIndex = '1050';
            alert.innerHTML = `
                <strong>Error!</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 5000);
        }
    </script>
</body>
</html>
